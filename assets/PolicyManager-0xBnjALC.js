import{c as U,j as e,Q as O,T as V,l as v,U as E,X as L,V as A,W as K,Y as W,Z as Y,r as n,J as q,$ as _,B as F,t as M,a0 as I,a1 as $,a2 as G,a3 as J,a4 as Q}from"./index-P07EYYl_.js";import{P as X}from"./papaparse.min-Bu2nSEcJ.js";import{T as Z,a as ee,b as H,c as te,d as ae,e as se}from"./table-CH6lpLJn.js";import{P as re,a as ne,b as z,c as oe,d as le,f as ie}from"./pagination-BgGkxENi.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],de=U("search",ce);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],me=U("upload",ue);function pe({...t}){return e.jsx(O,{"data-slot":"dialog",...t})}function ge({...t}){return e.jsx(W,{"data-slot":"dialog-portal",...t})}function xe({className:t,...s}){return e.jsx(Y,{"data-slot":"dialog-overlay",className:v("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function he({className:t,children:s,showCloseButton:o=!0,...u}){return e.jsxs(ge,{"data-slot":"dialog-portal",children:[e.jsx(xe,{}),e.jsxs(V,{"data-slot":"dialog-content",className:v("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...u,children:[s,o&&e.jsxs(E,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(L,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function fe({className:t,...s}){return e.jsx("div",{"data-slot":"dialog-header",className:v("flex flex-col gap-2 text-center sm:text-left",t),...s})}function be({className:t,...s}){return e.jsx("div",{"data-slot":"dialog-footer",className:v("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...s})}function ye({className:t,...s}){return e.jsx(A,{"data-slot":"dialog-title",className:v("text-lg leading-none font-semibold",t),...s})}function ve({className:t,...s}){return e.jsx(K,{"data-slot":"dialog-description",className:v("text-muted-foreground text-sm",t),...s})}function B({columns:t,data:s,pageSize:o=10,showSearch:u=!0,className:j,tableClassName:f,headerClassName:T,rowClassName:k,cellClassName:w}){const[i,g]=n.useState(1),[D,R]=n.useState(""),[S,C]=n.useState(""),[r,m]=n.useState(null),[c,b]=n.useState("asc");n.useEffect(()=>{const a=setTimeout(()=>{C(D),g(1)},300);return()=>clearTimeout(a)},[D]);const N=a=>{r===a?b(c==="asc"?"desc":"asc"):(m(a),b("asc"))},d=n.useMemo(()=>S.trim()?s.filter(a=>Object.values(a).some(l=>String(l).toLowerCase().includes(S.toLowerCase()))):s,[S,s]),p=n.useMemo(()=>r?[...d].sort((a,l)=>{const y=a[r],h=l[r];return c==="asc"?y>h?1:-1:y<h?1:-1}):d,[d,r,c]),x=Math.ceil(p.length/o),P=p.slice((i-1)*o,i*o);return e.jsxs("div",{className:`space-y-4 ${j??""}`,children:[u&&e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(de,{className:"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(q,{type:"text",placeholder:"Search...",value:D,onChange:a=>R(a.target.value),className:"pl-9"})]}),e.jsx("div",{className:"overflow-hidden rounded-md border shadow-sm",children:e.jsxs(Z,{className:f,children:[e.jsx(ee,{className:`sticky top-0 bg-background z-10 shadow-sm ${T??""}`,children:e.jsx(H,{children:t.map(a=>e.jsxs(te,{className:"p-2 cursor-pointer select-none",onClick:()=>N(a.key),children:[a.label,r===a.key&&(c==="asc"?" ↑":" ↓")]},String(a.key)))})}),e.jsx(ae,{children:P.map((a,l)=>{const y=typeof k=="function"?k(a,l):k??"";return e.jsx(H,{className:`border-t hover:bg-muted/50 transition-colors ${l%2===0?"bg-muted/20":""} ${y}`,children:t.map(h=>e.jsx(se,{className:`p-2 ${w??""}`,children:h.render?h.render(a[h.key],a):String(a[h.key]??"")},String(h.key)))},a.id)})})]})}),x>1&&e.jsx(re,{children:e.jsxs(ne,{children:[e.jsx(z,{children:e.jsx(oe,{onClick:()=>g(a=>Math.max(a-1,1)),className:i===1?"pointer-events-none opacity-50":""})}),Array.from({length:x},(a,l)=>e.jsx(z,{children:e.jsx(le,{isActive:i===l+1,onClick:()=>g(l+1),children:l+1})},l)),e.jsx(z,{children:e.jsx(ie,{onClick:()=>g(a=>Math.min(a+1,x)),className:i===x?"pointer-events-none opacity-50":""})})]})})]})}const je=()=>{const t=_(),[s,o]=n.useState(null),[u,j]=n.useState([]),[f,T]=n.useState([]),[k,w]=n.useState(!1),i=n.useRef(null),g=["id","name","type","renewalDate","premium","maturityDate"],D=[{label:"ID",key:"id"},{label:"Name",key:"name"},{label:"Type",key:"type"},{label:"Renewal Date",key:"renewalDate"},{label:"Premium",key:"premium"},{label:"Maturity Date",key:"maturityDate"}],R=r=>{const m=r.target.files?.[0];m&&(o(m),X.parse(m,{header:!0,skipEmptyLines:!0,complete:c=>{const b=c.data,N=c.meta.fields??[];if(!(g.length===N.length&&g.every((x,P)=>x===N[P]))){M.error("Invalid CSV format. Please use the correct policy structure."),o(null),i.current&&(i.current.value="");return}const p=[];b.forEach((x,P)=>{const a=g.filter(l=>{const y=x[l];return!y||y.toString().trim()===""});a.length>0&&p.push({index:P,missingFields:a})}),p.length>0&&M.error(`Found ${p.length} invalid row(s) with missing fields. Please review before uploading.`),T(p),j(b),w(!0)}}))},S=async()=>{try{const m=(await I.get("http://localhost:3001/policies")).data,c=Math.max(...m.map(d=>d.id),0),b=u.map((d,p)=>({...d,id:c+p+1}));await Promise.all(b.map(d=>I.post("http://localhost:3001/policies",d)));const N=await I.get("http://localhost:3001/policies");t($(N.data)),M.success("Policies uploaded successfully!"),C()}catch{M.error("Upload failed. Please try again.")}},C=()=>{o(null),j([]),T([]),i.current&&(i.current.value=""),w(!1)};return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Upload CSV File"}),e.jsx("input",{ref:i,type:"file",accept:".csv",onChange:R,className:`mt-2 block w-full text-sm text-gray-500\r
            file:mr-4 file:py-3 file:px-6\r
            file:rounded-lg file:border-0\r
            file:text-sm file:font-semibold\r
            file:bg-gradient-to-r file:from-blue-500 file:to-blue-700\r
            file:text-white hover:file:brightness-110`})]}),s&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Selected file: ",e.jsx("strong",{children:s.name})," (",(s.size/1024).toFixed(2)," KB)"]}),e.jsx(pe,{open:k,onOpenChange:r=>{w(r),r||C()},children:e.jsxs(he,{className:"inline-block w-auto p-2 space-y-4",children:[e.jsxs(fe,{children:[e.jsx(ye,{children:"Confirm Upload"}),e.jsxs(ve,{children:["You're about to upload ",e.jsx("strong",{children:u.length})," ","policies.",e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:["File: ",e.jsx("strong",{children:s?.name})," (",(s?.size/1024).toFixed(2)," KB)"]})]})]}),e.jsx(B,{columns:D,data:u,pageSize:5,showSearch:!1,className:"bg-white p-6 rounded-xl",tableClassName:"table-auto w-auto text-sm",headerClassName:"bg-gray-100",rowClassName:(r,m)=>f.some(c=>c.index===m)?"bg-red-50 hover:bg-red-100":"hover:bg-gray-50",cellClassName:"text-gray-700"}),f.length>0&&e.jsxs("div",{className:"text-sm text-red-600 space-y-1",children:[e.jsx("p",{className:"font-semibold",children:"Issues found:"}),f.map(r=>e.jsxs("p",{children:["Row ",r.index+1,": Missing ",r.missingFields.join(", ")]},r.index))]}),e.jsxs(be,{className:"mt-4",children:[e.jsx(F,{variant:"outline",onClick:C,children:"Cancel"}),e.jsxs(F,{onClick:S,disabled:f.length>0,className:`bg-gradient-to-r from-blue-500 to-blue-700 text-white hover:from-blue-600 hover:to-blue-800 flex items-center gap-2 ${f.length>0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(me,{className:"w-4 h-4"}),"Confirm Upload"]})]})]})})]})},Ne=J("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function ke({className:t,variant:s,asChild:o=!1,...u}){const j=o?G:"span";return e.jsx(j,{"data-slot":"badge",className:v(Ne({variant:s}),t),...u})}const we=[{label:"ID",key:"id"},{label:"Name",key:"name"},{label:"Type",key:"type",render:t=>{const o={Health:"bg-green-100 text-green-800",Auto:"bg-blue-100 text-blue-800",Life:"bg-purple-100 text-purple-800",Travel:"bg-yellow-100 text-yellow-800"}[t]??"bg-gray-100 text-gray-800";return e.jsx(ke,{className:o,children:t})}},{label:"Renewal Date",key:"renewalDate"},{label:"Premium",key:"premium"},{label:"Maturity Date",key:"maturityDate"}],De=()=>{const t=Q(s=>s.policyData.policies);return e.jsx("div",{className:"p-4",children:e.jsx(B,{columns:we,data:t,pageSize:10})})},Me=()=>{const t=_();return n.useEffect(()=>{I.get("http://localhost:3001/policies").then(s=>{t($(s.data))})},[t]),e.jsxs("div",{className:"max-w-6xl mx-auto mt-0 space-y-6 px-4",children:[e.jsx("h1",{className:"text-xl font-bold text-blue-700",children:"Policy Overview"}),e.jsx(je,{}),e.jsx(De,{})]})};export{Me as default};
